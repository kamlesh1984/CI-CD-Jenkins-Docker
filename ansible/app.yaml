---
- hosts: tomcatServer
  vars:
  - warName:  http://10.207.146.155:8081/artifactory/Jenkins-snapshot/com/javawebtutor/LoginWebApp/1.0-SNAPSHOT/LoginWebApp-1.0-20180807.094227-1.war
  - warRemotePath: /root/tomcat/apache-tomcat-8.0.53/webapps
  - name: Download file with custom HTTP headers
    get_url:
      url: {{ warName }}
      dest: {{ warRemotePath }}

 # tasks:
 # - name: Download WAR to server
 #   command: http://10.207.146.155:8081/artifactory/Jenkins-snapshot/com/javawebtutor/LoginWebApp/1.0-SNAPSHOT/LoginWebApp-1.0-20180807.094227-1.war -O {{ warRemotePath }}/{{ warName }}
  
 # - name: Unzip WAR file
 #   unarchive: src={{ warRemotePath }}/{{ warName }} dest=/var/lib/tomcat7/webapps/ROOT/ copy=no mode=0755 owner=tomcat7 group=tomcat7
 #   notify:
 #       - restart tomcat7
   
  - name: Delete remote war file
    file: path={{ warRemotePath }}/{{ warName }} state=absent

  handlers:
    - name: Restart tomcat8
      service: name=tomcat8 state=restarted
